tasks:
  buildnumber:
    context: pwshgo
    command:
      - Update-BuildNumber -buildnumber $env:BUILDNUMBER

  clean:
    context: pwshgo
    description: Clean old builds
    command:
      - rm -rf outputs

  _compile:
    description: Compile CLI and Integration Tests
    context: pwshgo
    command:
      - /eirctl/build/scripts/Invoke-Compile.ps1

  _docs:
    description: Build Docs for Stacks CLI
    context: docsenv
    command:
      - Build-Documentation -Config /eirctl/manual.json

  test:unit:
    context: pwshgo
    description: Run Unit Tests
    command:
      - /eirctl/build/scripts/Invoke-UnitTests.ps1

  test:int:
    context: inttestenv
    description: Run Integration Tests

    command:
      - /eirctl/build/scripts/Invoke-IntegrationTests.ps1 -build_number $BUILDNUMBER -RunTests

  test:int:generate_report:
    context: pwshgo
    command:
      - /eirctl/build/scripts/Invoke-IntegrationTests.ps1 -build_number $BUILDNUMBER -Report

  _release:
    context: pwshgo
    command:
      - |
        $InformationPreference = "Continue"
        $cmd = "Publish-GitHubRelease -version $env:BUILDNUMBER `
          -commitId $env:COMMIT_ID `
          -apikey $env:API_KEY `
          -artifactsDir $env:ARTIFACTS_DIR `
          -Owner $env:OWNER `
          -repository $env:REPOSITORY `
          -publishRelease $true"
        Write-Host $cmd
        Invoke-Expression $cmd

  debug:buildnumber:
    # context: pwshgo
    command:
      - echo "Build Number - $BUILDNUMBER"
